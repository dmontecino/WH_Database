<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>wildlife_health_database_rules</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Wildlife_Health_Database_Rules_files/libs/clipboard/clipboard.min.js"></script>
<script src="Wildlife_Health_Database_Rules_files/libs/quarto-html/quarto.js"></script>
<script src="Wildlife_Health_Database_Rules_files/libs/quarto-html/popper.min.js"></script>
<script src="Wildlife_Health_Database_Rules_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Wildlife_Health_Database_Rules_files/libs/quarto-html/anchor.min.js"></script>
<link href="Wildlife_Health_Database_Rules_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Wildlife_Health_Database_Rules_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Wildlife_Health_Database_Rules_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Wildlife_Health_Database_Rules_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Wildlife_Health_Database_Rules_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="the-wildhealthdat-database" class="level1">
<h1>THE WILDHEALTHDAT DATABASE</h1>
<p>WildlifeHealthDat is a flexible database built to track wildlife health data collected from a wide range of surveillance efforts, including citizen observations of dead, injured or sick animals, specific research, national or local wildlife health surveillance initiatives, outbreak investigations, and global wildlife health surveillance projects involving several countries, hazards, and host species.</p>
<p>The database is based on the decades-long experience of the Wildlife Conservation Society - Health Program. This experience includes wildlife health surveillance activities covering dozens of countries; cross-sectional and longitudinal studies; the establishment of wildlife health surveillance networks; many biological, chemical, and physical hazards; studying dangerous zoonotic pathogens, such as Ebola virus disease and SARS-CoV-2; emerging vector-borne pathogens such as West Nile virus; the inclusion of rangers in protected areas and surrounding communities as eyes-on-the-ground for health surveillance; the logistics needed and challenges faced to properly manage, store, and track specimens collected in the field; necropsies; different kinds of diagnostic tests; and previous experiences managing wildlife health data using different Information Managament Systems.</p>
<p>The wildlife health information is stored in the database following structured components ranging from Surveillance Objective up to Specimens and Diagnostic tests. The hierarchical structure of the databse components is: i) Projects &gt;&gt; Surveillance Objectives &gt;&gt; Field Activities &gt;&gt; Locations &gt;&gt; Incidents &gt;&gt; Sources &gt;&gt; Records &gt;&gt; Specimens &gt;&gt; Diagnostics. There are four types of Sources; however, the database is modular, adjusting and selecting those components needed specifically for each surveillance initiatives and their participants have.</p>
<p>Each one of these components is explained below.</p>
<section id="project" class="level2">
<h2 class="anchored" data-anchor-id="project">PROJECT</h2>
<p>It is a surveillance initiative supported by specific entities. For example, the PREDICT Project funded by USAID, an isolated cross-sectional study with a single field visit to a single location (sample collection in a market), or a national or local wildlife health surveillance network lead by a government agency. Projects are the highest hierarchical unit in the database and they contain at least one surveillance objective.</p>
</section>
<section id="surveillance-objective" class="level2">
<h2 class="anchored" data-anchor-id="surveillance-objective">SURVEILLANCE OBJECTIVE</h2>
<p>It is a set of activities established to collect data in order to detect, quantify, or assess trends regarding specific health hazards in specific populations under a common methodology. Each Surveillance Objective should have a specific population and hazard target, Source or Specimen Collection methods, and Diagnostics. For example, a capture-mark-recapture study targeting lead accumulation in a specific population of vultures that involves blood collection and testing at every capture using the same diagnostic technique. Surveillance Objective is the most complicated component of the database. Read this section carefully.</p>
<p>Surveillance Objectives contain very specific metadata, describing their goals and methods used, including targeted species, populations, and hazards; the type of Sources and Specimens included; collection methods; and case definitions for specific Diagnostics, Specimens, and Sources. Some pieces of the metadata are provided by Source type (Observation, Animal Source, Environmental Source, and Invertebrate Source, [see below]).</p>
<p>Surveillance Objectives apply for targeted surveillance and scanning surveillance initiatives so both types can be described through the metadata. All Outbreak Investigations are a Surveillance Objective, although the outbreak information (name and diagnosis) can be provided later and not immediately after the Surveillance Objective creation in the database.</p>
<p>Usually, Field Activities, Locations, Incidents, Sources, Records, and Diagnostics belong to a single Surveillance Objective. This Surveillance Objective is the one that originally requested the Field Activity at different Locations to record the corresponding Incidents, collect the Sources and Specimens, and perform Diagnostics for a specific hazard. In this case, the Surveillance Objective is provided automatically to each corresponding component.</p>
<p>However, there are exceptions to this rule, except for Diagnostics, and the exceptions have different justifications for each component. Field Activities, Locations, Incidents, Source Records, and Specimens can be originally requested by different Surveillance Objectives planning the same activities and methods but that differ in the targeted hazard. For example, rodents sampled using the same methodology that will be tested for Coronaviruses and Rickettsia sp. It is the user responsibility to add the second Surveillance Objective to the corresponding Field Activities, Locations, Incidents, Source Records, and Specimens.</p>
<p>Another exception can occur when Source Records and Specimens collected under scanning surveillance efforts are included in future targeted surveillance initiatives. For example, using pangolin Specimens collected by rangers patrolling a protected area in 2017 under a scanning surveillance strategy that are tested in 2023 for SARS-CoV-2 as part of a targeted surveillance initiative. In this case, the corresponding Specimens tested for SARS-CoV-2 and their Sources will have more than one Surveillance Objective. The one that originally demanded conducting the Field Activity to collect the Source Record and Specimens, and the new Surveillance Objective targeting SARS-CoV-2. This last Surveillance Objective <u>DOES NOT</u> generate new Field Activities, Locations, or Incidents. Finally, each Diagnostic remains having a single Surveillance Objective (new Diagnostics targeting SARS-CoV-2 receive the SARS-CoV-2-related Surveillance Objective only).</p>
<p>Moreover, during Surveillance Objective targeting SARS-CoV-2 new Necropsies might be conducted, new Specimens could be created (from larger stored Specimens, such as a carcass or an organ), or new Pooled Specimens could be produced. All these components receive the Surveillance Objective targeting SARS-CoV-2 only. Again, it is the user responsibility secondary Surveillance Objective to the corresponding Source Records, Specimens and Diagnostics.</p>
<p>Therefore, a Surveillance Objective can be linked to others because they belong to the same Project; they requested the same Field Activities, Locations, and Incidents; or they have Sources and Specimens in common. If Surveillance Objectives are connected for the second and third reason, then this connection must be provided in the metadata of the corresponding Surveillance Objectives. The connections will be also evident in the exported data such that each component with more than one Surveillance Objective (Field Activity,…, Specimens) will be represented by one row per Surveillance Objective.</p>
</section>
<section id="field-activity" class="level2">
<h2 class="anchored" data-anchor-id="field-activity">FIELD ACTIVITY</h2>
<p>A Field Activity correspond to a field visit with a start and end date. Each one of these Field Visits could involve more than one Surveillance Objective (see above) and Locations (see below) of different types such as markets, natural areas, rehabilitation centers, caves, etc.</p>
</section>
<section id="locations" class="level2">
<h2 class="anchored" data-anchor-id="locations">LOCATIONS</h2>
<p>A Location is a general place where Incidents, Source Records, and Specimens are collected. For example, a single Field Visit could involve different places: two rehabilitation centers, one cave in a protected area, and three areas of another protected area. These examples include six Locations. A Location groups data in a more general manner than the exact longitude and latitude of the data collection (see ‘Incidents’ below that contain the latitude and longitude information) but that is more specific than ‘Field Activity’.</p>
<p>In the examples provided in the previous paragraph, a ‘market’ could be a ‘Location’ or an ‘Incident’ by itself (see below) depending on what the user considers the best choice for the corresponding Surveillance Objective. More detail about what an Incident represents is provided in the next section.</p>
</section>
<section id="incidents" class="level2">
<h2 class="anchored" data-anchor-id="incidents">INCIDENTS</h2>
<p>An Incident is a specific wildlife health event at specific longitude and latitude and that occurs in a specific date.</p>
<p>The definition of what a wildlife health event (and therefore of the ‘Incident’ component) depends on the Surveillance Objective methodology. In targeted surveillance efforts, an Incident could imply just healthy animals sampled in a specific time-space unit to test them for the targeted hazard. Non-sampled individuals, injured, sick, or dead may or may not be included as part of the Incident. If samples are collected from a river, then the ‘Incident’ can be equivalent to the location where water is extracted at. For the surveillance of vector-borne diseases, an ‘Incident’ could be a point in time and space where one to several traps for vectors have been placed. For scanning surveillance, an ‘Incident’ could require the presence of at least one injured, sick, or dead animal, or an stranded individual. The ‘Incident’ can also include the healthy individuals found nearby.</p>
<p>In the case of beached fish, an Incident could represent each dead fish in one extreme. On the other extreme an Incident can represent to the full count of dead fish across the beach as a single point in time and space. None of these strategies seem ideal. The former, for logistic purposes and the latter, for the loss of valuable information (distribution of the dead fish across the beach). So an Incident should represent a unit in between.</p>
<p>Similarly, an entire market could represent a ‘Location’ and a single ‘Incident’ at the same time. This Incident can gather data from several vendors, cages, and animals within cages. On the other hand, a market could be a ‘Location’ and each vendor within the market could be an ‘Incident’. Finally, a structured study can involve several levels of hierarchy and one of them receives the temporo-spatial coordinate. Another similar structured study (zone, grid, area, trap, etc.) might provide the spatial coordinate to a different unit (for example the area in one case and the trap in another case). Therefore, an Incident can represent a wide range of units depending on the methodology used to record health ata. For this reason, it is necessary to provide flexibility to what an Incident is per surveillance design and it is also necessary to request and explicitly declare what an Incident represents as part of its data.</p>
<p>In the market example or structured studies, it could be desired to group Incidents more specifically than under the general ‘Location’. For example, a market can be a ‘Location’ and each cage could represent an ‘Incident’. It is possible that users want to group cages by vendors and vendors by area within the market, Similarly, it is possible that in a structured study the ‘Incident’ represents a trap, and the researchers want to group traps these Incidents by area, grid cell, zone, and season. For this reason, the database contains several ‘Incident’ tags to group them temporally, spatially, or both in a finer scale than Location. Specific tags can be requested by users.</p>
<p>Incidents must have at least one Source Record from one Source type (see below) and as many Source Records of any type as needed (depending on what is found/recorded in each specific Incident and what is the interest of the corresponding Surveillance Objective).</p>
</section>
<section id="sources-and-source-records" class="level2">
<h2 class="anchored" data-anchor-id="sources-and-source-records">SOURCES AND SOURCE RECORDS</h2>
<p>A Source is an entity of interest within each Incident from which health information is collected or generated. There are four classes of Sources with different properties: Observations, Animal Source, Environmental Source, and Invertebrate Source (see below for a full description of each type). Following the modular properties of the database, the Source types become available depending on the Surveillance Objective methods and goals per user request.</p>
<p>Each Source contains at least one Source Record (Source recorded at time t). Depending on the type, a Source can be recorded multiple times (several Source Records). For example, a capture-mark-recapture study with animals bled and tested at each capture instance. Obviously, the first time a Source is entered in the database corresponds to its first Source Record.</p>
<p>A Source has immutable information over time. A Source Record has information of a specific Source that is mutable over time. Most Sources can provide Specimens such as full carcasses, body parts, fluids, tumors, blood, water, sediment, invertebrates, etc. These Specimens can be obtained during any of the Source Records of the corresponding Source.</p>
<p>Observations provide only a single Source Record (see below). Animal Sources, Environmental Sources, and Invertebrate Sources can provide as many Source Records as needed.</p>
<section id="observation" class="level3">
<h3 class="anchored" data-anchor-id="observation">Observation</h3>
<p>An Observation corresponds to <u>observed-only animal(s)</u> present at one Incident <u>grouped by species</u>. For example, a wildlife health event involving a single isolated injured animal. If this individual is observed only, then the Incident has a single Observation representing a single species. The animal count for that single species is one.</p>
<p>Another example: five animals are found in a wetland, two of them of species “A” and three of them of species “B”. One animal of species “A” is sick. If they are only observed and the Surveillance Objective is not interested in individual animal-level data,then this set of findings is a wildlife health ‘Incident’ with two ‘Observations’. One ‘Observation’ represents species “A” (one healthy individual and one sick animal), and another ‘Observation’ represents species “B” (three healthy individuals).</p>
<p>Incidents can include Observations (species) with healthy animals only, as long as they are part of a wildlife health event.</p>
<p>Each Observation generates one and only one Source Record. In that unique Record for the Observation animals are categorized by sex, age and health status. The captivity categories of the corresponding animals; their anomalies; and potential causes of injury, disease, or dead can be provided.</p>
<p>If the same set of only-observed animals are believed to be found five days latter, then a new Observation must be created because there is not certainty that they are the same individuals. If users want to track the animals longitudinally, they should be added singly to the database as ‘Animal Source’ (see below).</p>
</section>
<section id="animal-source" class="level3">
<h3 class="anchored" data-anchor-id="animal-source">Animal Source</h3>
<p>An Animal Source represents an individual animal. Animal Sources can be added because the Surveillance Objective aims to collect individual-level health information (e.g., individual findings in stranded pilot whales), because the Animal Sources provide Specimens to perform Diagnostics or to be stored (carcass, body part, tissue, organs, samples, etc), or because a Diagnostic is conducted in individual animals that do not necessarily provide Specimens (e.g., evident hair loss in a free-ranging red fox).</p>
<p>Immutable data of Animal Sources are the sex, the species, and the date of death. Previous marking codes (if any has been used) are immutable; however, current marking codes are considered mutable and are provided in the corresponding Animal Source Record (see below).</p>
<section id="animal-source-record" class="level5">
<h5 class="anchored" data-anchor-id="animal-source-record">Animal Source Record</h5>
<p>Each Animal Source has at least one Source Record. This first Source Record corresponds to the unique record of an unidentified individual animal or to the first record of an individually identified animal. Individually identified animals can potentially be tracked over time and have as many Source Records as needed.</p>
<p>Mutable data of an Animal Source over time that has to be provided for each Source Record are the captivity category, the health status, the age, and the marking code. These are one option features per Animal Source Record. Other mutable data for Animal Sources that can have multiple values in each Animal Source record are the anomalies found and the potential causes of injury, disease, or death. Obviously, the time t the Animal Source is recorded is also mutable.</p>
<p>The last Animal Source Record for an animal is not necessarily the last time t when it was found dead because it is possible to collect Specimens from the carcass (dead Animal Source) over a period of time while the carcass is rooting.</p>
</section>
<section id="necropsies" class="level5">
<h5 class="anchored" data-anchor-id="necropsies">Necropsies</h5>
<p>Necropsies are associated with the specific Animal Source Record when the carcass was collected. However, the Necropsy date can be any date since the corresponding Animal Source Record creation.</p>
<p>Necropsies can be primary or secondary. Primary necropsies usually start with an intact carcass (not previously used in a necropsy). Secondary necropsies are usually conducted by a veterinarian pathologist using pictures of the primary necropsy or using a carcass already necropsied.</p>
<p>New Specimens can be generated during a Necropsy (e.g., samples from organs). In this case the date of Specimen collection is not the date of the Animal Source Record when the carcass was collected, but the date of the Necropsy (primary or secondary). It is possible to track if a Specimen was collected during the primary or secondary Necropsy based on the information collected in Specimens (see below).</p>
</section>
</section>
<section id="environmental-sources" class="level3">
<h3 class="anchored" data-anchor-id="environmental-sources">Environmental Sources</h3>
<p>An Environmental Source represents an entity that provides Specimens that: i) are abiotic (e.g., a location of a frozen pond that is sampled for Avian influenza), or ii) are biotic but it is not possible to identify the corresponding Animal Source (e.g., feces found in the field).</p>
<p>Immutable data of Environmental Sources are the type of Environmental Source. Setting the Environmental Source type determines the Specimen type provided for those Sources. For example, feces can only yield feces as Specimens, and water in a pond can only provide water.</p>
<section id="environmental-source-record" class="level5">
<h5 class="anchored" data-anchor-id="environmental-source-record">Environmental Source Record</h5>
<p>Each Environmental Source has at least one Source Record. This first Source Record corresponds to the unique record of an unidentified Environmental Source (e.g., feces on the ground) or to the first record of an individually identified Environmental Source (e.g., water collected at a specific place in the pond). Individually Environmental Sources can potentially be tracked over time and have as many Source Records as needed.</p>
<p>Environmental Sources do not have mutable data except the time t when they are sampled.</p>
</section>
</section>
<section id="invertebrate-sources" class="level3">
<h3 class="anchored" data-anchor-id="invertebrate-sources">Invertebrate Sources</h3>
<p>Designed to contain data of a collection of invertebrates. If the interest is at the individual level (e.g., bees with problems in their wings), then the data should be recorded as Animal Source</p>
</section>
</section>
<section id="final-comment-on-sources-and-source-records" class="level2">
<h2 class="anchored" data-anchor-id="final-comment-on-sources-and-source-records">FINAL COMMENT ON SOURCES AND SOURCE RECORDS</h2>
<p>Users can group Source Records from different Sources beyond the Incident they belong to. For example, a Surveillance Objective design involves sampling animals and cages in a market as part of targeted surveillance efforts. One of the potential options to structure these data is to set the market as the Location and set each vendor within the market as an ‘Incident’. Let’s pretend that in one of the Incidents (a vendor) a sample of feces is collected from the bottom of a cage, the cage has three animals of the same species, and only one of those animals is sampled (one oral swab sample).</p>
<p>Under this scenario, the cage is providing three Source Records. Firstly, an Environmental Source with a single Environmental Source Record containing the feces sampled from the bottom of the cage. Secondly, an Observation with the two animals in the cage that are only observed (Observations always have a single Record). And thirdly, an Animal Source with a single Animal Source Record containing the oral swab.</p>
<p>How to track that these Source Records belong to the same cage? The database provide tags per user request that allow to label Sources Records that belong to units lower than Incidents and keep them linked in the data. In the example, the three Source Records can receive the same tag (“cage1”) in order to track that they have a more specific origin than Incident.</p>
</section>
<section id="specimens" class="level2">
<h2 class="anchored" data-anchor-id="specimens">SPECIMENS</h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>